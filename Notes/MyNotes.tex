%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Simple Sectioned Essay Template
% LaTeX Template
%
% This template has been downloaded from:
% http://www.latextemplates.com
%
% Note:
% The \lipsum[#] commands throughout this template generate dummy text
% to fill the template out. These commands should all be removed when
% writing essay content.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[10pt,twoside,a4paper]{article} % Default font size is 12pt, it can be changed here

\usepackage{geometry} % Required to change the page size to A4
\geometry{legalpaper, margin=2.5cm}


\usepackage{graphicx} % Required for including pictures
\usepackage{cancel}
\usepackage{float} % Allows putting an [H] in \begin{figure} to specify the exact location of the figure
\usepackage{wrapfig} % Allows in-line images such as the example fish picture
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{lipsum} % Used for inserting dummy 'Lorem ipsum' text into the template
\usepackage{amssymb}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead[RO,LE]{\thepage}
\fancyhead[LO]{SIMULATION SCIENCES SEMINAR NOTES}
\fancyhead[RE]{\leftmark}

\linespread{1.0} % Line spacing

%\setlength\parindent{0pt} % Uncomment to remove all indentation from paragraphs

\graphicspath{{Pictures/}} % Specifies the directory where pictures are stored

% \renewcommand{\thesection}{\Roman{section}}
% \renewcommand{\thesubsection}{\thesection.\Roman{subsection} }

\begin{document}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\begin{titlepage}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for the horizontal lines, change thickness here

\center % Center everything on the page

\textsc{\LARGE RWTH Aachen University}\\[1.5cm] % Name of your university/college
\textsc{\Large Simulation Sciences seminar}\\[0.5cm] % Major heading such as course name
\textsc{\large Sensitivity analysis on chaotic dynamical systems by NILSS}\\[0.5cm] % Minor heading such as course title

\HRule \\[0.4cm]
{ \huge \bfseries Personal notes for the seminar}\\[0.4cm] % Title of your document
\HRule \\[1.5cm]

\begin{minipage}{0.4\textwidth}
\begin{flushleft} \large
\emph{Author:}\\
Uriel \textsc{Aceves} % Your name
\end{flushleft}
\end{minipage}
~
\begin{minipage}{0.4\textwidth}
\begin{flushright} \large
\emph{Supervisor:} \\
Dr. Johannes \textsc{Lotz} % Supervisor's Name
\end{flushright}
\end{minipage}\\[4cm]

{\large \today}\\[3cm] % Date, change the \today to a set date if you want to be precise

\includegraphics{logo.png}\\[1cm] % Include a department/university logo - this will require the graphicx package

\vfill % Fill the rest of the page with whitespace

\end{titlepage}

%----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
%----------------------------------------------------------------------------------------

\tableofcontents % Include a table of contents

\newpage % Begins the essay on a new page instead of on the same page as the table of contents

%----------------------------------------------------------------------------------------
%	INTRODUCTION
%----------------------------------------------------------------------------------------


\section*{Disclaimer}
This notes are with the sole intention of better understanding the article that we will use for the simulation sciences seminar \cite{Wang}, and clarify some aspects in more depth. So they will be redundant with the cited paper, and in most cases the phrases will be either paraphrasing or literal copies of the original ones. For this reason the constant citations to \cite{Wang} will be omited, but we urge the reader to keep in mind that we are deliberately ommiting them.
\section{Abstract}
On this paper the Non-Intrusive Least Squares Shadowing (NILSS) is developed, the so called method computes the sensitivity\footnote{Sensitivity is the quantity that allows us to know how small changes on the initial conditions will affect the system for long time periods.} of quantities that are being averaged over long periods of time on chaotic dynamical systems. In NILSS tangent solutions\footnote{God knows what is a tangent solution} are represented as a linear combination of one inhomogeneous tangent solution and several homogeneous tangent solutions, in other words we take the decomposition of such tangent solution in homogeneous and inhomogeneous parts. The next step is to solve a least squares problem\footnote{Minimizing the sum of the squares of some quantities} using this decomposition. And hence the resulting solution can be used to compute the sensitivity\footnote{It remains to see how}. Advantages of this method is that it is easy to implement on existing solvers. furthermore, it has a low computational cost for systems with many degrees of freedom but few unstable modes\footnote{How do we know this and why? Additionaly, what is an unstable mode?}. On the paper NILSS is applied to two systems, Lorenz 63 and CFD simulation of flow over a backward-facing step. As a result, in both cases the sensitivities computed by NILSS reflect the common behaviour in the long-time averaged quantities of dynamical systems\footnote{I don't really know what the common behaviour is}.

\section{Introduction}
Many important phenomena in engineering and sciences are described by chaotic systems. In these systems, we are often interested in properties obtained from long-time averaged quantities. The main problem is, the systems are chaotic, and as a consequence, small changes in the initial data can lead to very different behaviours as time increases. The aim of the paper, is then, to provide tools to analyse the sensitivities of such systems, i.e. how a change on the initial data or the parameters affects the properties we are interested on.

In order to define the problem we pose the differential equation governing the phenomenon and the initial conditions,

\begin{equation}
\frac{du}{dt} = f(u,s), \quad u(t=0) = u_0(\phi),
\label{eq:1}
\end{equation}
where $f(u,s): \mathbb{R}^m \times \mathbb{R} \rightarrow \mathbb{R}^m$\footnote{I need to think about that m on the dimension.} is a smooth function, $u$ is the state of the system, and $s$ is the parameter. The initial condition $u_0$ is a smooth function of $\phi$\footnote{What is $\phi$}. Finally, a solution $u(t)$ will be called the primal solution.

In the paper the objetives are long-time averaged quantities. To define them let $J(u,s): \mathbb{R}^m \times \mathbb{R} \rightarrow \mathbb{R}$ be a continuous function representing the instantaneous objective function. Then we can obtain the objective by averaging over an infinitely long trajectory

\begin{equation}
  \langle J \rangle_\infty := \lim_{t\to\infty} \langle J \rangle_T, \textrm{ where } \langle J \rangle_T := \frac{1}{T}\int_0^T J(u,s)dt,
  \label{eq:2}
\end{equation}
$\langle J \rangle_T$ depends on $u$, $s$ and $\phi$, while $\langle J \rangle_\infty$ is determined only by $s$ and $u_0$\footnote{Why not from $\phi$}. If we assume ergodicity, i.e. $\langle J \rangle_T = \langle J \rangle_\infty$, this will mean that $u_0$, and as a consequence $\phi$ does not affect $\langle J \rangle_\infty$\footnote{I don't really understand why}, and as a result $\langle J \rangle_\infty$ only depends on $s$.

The mathematical definition of sensitivity is $d\langle J \rangle_\infty / ds$. Such sensitivity can be useful to solve inverse problems, estimate simulation errors, quantify uncertanties and other things\footnote{Sources are cited on the paper, I might want to go and read superficially some of them just to know}.

When the system is chaotic the computation of sensitivity is challenging, since

\begin{equation}
  \frac{d}{ds} \langle J \rangle_\infty \neq \lim_{t\to \infty} \frac{\partial}{\partial s} \langle J \rangle_T (s,\phi,T).
  \label{eq:3}
\end{equation}
This means that, if we fix the initial conditions $u_0(\phi)$, the process of $T\to\infty$ does not commute with differentiation by $s$\footnote{Basically on the left hand side first we let $T\to\infty$ and then differentiate, on the right hand side first we differentiate and then let $T\to\infty$}. And as a result, the transient method does not converge to the correct sensitivity.

Many methods have been developed to compute sensitivities. The usual ones are finite differences and trasient method. There is also an ensemble method, which computes the sensitivity by averaging from the trasient method over an ensemble of trajectories.

One method that has proven to work correctly is Least Squares Shadowing, developed by Wang, Hu and Blonigan. Such method computes a bounded shift of a trajectory under an infinitesimal parameter change\footnote{Read or ask about this to at least know what is going on}. LSS has been succesfully applied to systems such as Lorenz 63 and a modified Kuramoto-Sivashinsky equation. Moreover, Wang has proven that, under assumptions of ergodicity and hyperbolicity, LSS converges to the correct sensitivity at a rate of $T^{-0.5}$, where $T$ is the trajectory time lenght\footnote{Basically as the inverse of the square root.}.

However using LSS is expensive, since it involves solving a linear system of $d*m\tau$, where $d$ is the dimension of the system and $m\tau$ the number of timesteps. In addition to this, it also requires the jacobian $\partial_uf(u,s)$ at each time step. And we consider this as a disadvantage since not all software provides the jacobian, and modify existing codes to include this calculation might not be trivial.

To tackle this problem the paper develops the Non-intrusive Least Squares Shadowing (NILSS). The computational and memory costs of NILSS are proportional to the number of positive Lyapunov Exponents (LE)\footnote{Read a little bit about LE}. NILSS also requires less modifications than LSS to be implemented on existing solvers since it does not requires the jacobian matrix.\footnote{Read about the jacobian}.

The rest of the paper follows this path: First, examine the long-time and trasient effects due to perturbations in the system parameters. It is also examined how trasient effects are generated by changes on the initial conditions. Next they describe the NILSS method as a procedure that gets the long-time effect from the trasient effect, where perturbations are represented by tangent solutions. Then a step-by-step description of the algorithm is presented. And finally the algorithm is applied to two systems.

\section{Connection between sensitivity to system parameters and initial conditions}

As we mentioned before, in order to get the objectives we must average over an infinitely long trajectory. Then the sensitivity of the objective can be revealed by looking at perturbations in the trajectories due to perturbations in the parameters. This section is devoted to perturbations arising from perturbations on the parameters.

As we know, trajectories of a chaotic dynamical system depend sensitively on system parameters, i.e. if we slightly change the values of the parameters, the new trajectory will be significantly different from the original one, even when they have the same initial conditions. This is similar to another sensitive dependence on the initial conditions, known as the butterfly effect\footnote{Not exactly like the movie but kind of.}.


In order to show the similarity between both sensitivities, the Lorenz 63 system is considered\footnote{Lorenz 63 is a simplified ODE model for atmospheric convection.}. This system has 4 degrees of freedom, $x$, $y$, $z$, and $\rho$. In Fig. \ref{fig:lz63}, both sensitivities are shown. In the left column, on the x-z axis they plot planar snapshots of $1.8\times10^7$ trajectories with varying $\rho$n the left column, on the x-z axis they plot planar snapshots of $1.8\times10^7$ trajectories with varying $\rho$ but with the same initial condition,
\begin{wrapfigure}{l}{0.5\textwidth} % Inline image example
  \begin{center}
    \includegraphics[width=0.48\textwidth]{lz63.png}
  \end{center}
  \caption{Snapshots of Lorenz 63. Left side varying $\rho$ and right side varying the initial conditions. Their respective times are 1.67, 5.0, 10.0 and 41.67.}
  \label{fig:lz63}
\end{wrapfigure}
$u_0 = (12.00, 6.82, 36.47)$. Here $\rho$ is uniformly distributed on the interval $[27,29]$. A smaller $\rho$ is indicated by colors with shorter wavelenghts, smaller is indicated by blue, larger by red. On the right column, they plot snapshots of the same number of trajectories with the same density $\rho = 28$, but with a varying initial condition. Such conditions are characterized by vectors uniformly distributed along $u_0 \pm \Delta u_0$, where $\Delta u_0 = [0.0939,-0.001053,1.05]$\footnote{Those numbers come from the NILSS solution}. Later they will see that $\Delta u_0$ is chosen to have similar effects to the trasient effect of varying $\rho$.

There are many similarities and small differences between the effects observed when $\rho$ is varying and when the initial conditions $u_0$ are changed. As we can see on the first three rows of Fig. \ref{fig:lz63}, in the sorth time, changing $\rho$ results in diverging trajectories which look like the effect of only varying $u_0$: we call this the transient effect\footnote{Read more about this effect, it looks interesting.}.

The picture on the last row of Fig. \ref{fig:lz63} is obtained after letting trajectories evolve for a long time. The picture on the left, has a similar shape as the atractor on the right. However the picture on the left is a superposition of many attractors with different parameters, and if we take a closer look, we can see that it actually has different colors on certain parts (for example on the top). The red color on the upper rim, and the blue on the lowe, indicates that as $\rho$ increases, the attractor moves upward. As a conclussion, varying $\rho$ results in a shifted attractor: and they call this the long-time effect\footnote{Long-time effect: the attractor shifts as $\rho$ changes.}.

the long-time effect generated from vrying $\rho$ is important for computing the long-time sensitivity, however, it is hidden on diverging trajectories and it can only be appreciated after a long time and an ensemble of millions of trajectories. As noted before, the transient effect is reflected by diverging trajectories, hence, if we can find two non-diverging trajectories, one with $\rho$ and the other with $\rho+\Delta \rho$ then their difference will not contain the transient effect. And therefore their difference will only have the long-time effect\footnote{What do we understand from ``non-diverging"?}.

The main goal of the paper is then to devise a method able to generate the transient effect and then take it away from a varying $\rho$, so that we can find trajectories that do not diverge from one another, and whose difference contains only the long-time effect. As a matter of fact, in Fig. \ref{fig:lz63}, $\Delta u_0 = v\Delta p$ and $v$ represents the NILSS solution. As they show aveltually, this change in the initial conditions yields the transient effect, an by subtracting it from the two effects of a varying $\rho$, we can obtain the long-time effect using a short trajectory.

\section{The idea of tangent NILSS}

To strenghten up the ideas developed in the last section, in Section \ref{3.1}, the two perturbations are characterized mathematically as two different tangent solutions, i.e. inhomogeneous and homogeneous tangents. To get the long-time effect $v$ (inhomogeneous tangent), we construct an homogeneous tangent $w$ representing the long-time effect, and sustract it from the conventional inhomogeneous one $v^*$. Both effects are included in $v^*$. In Section \ref{3.2} is shown how to construct $w$ as a linear combination of unstable Characteristic Lyapunov Vectors (CLV). In Section \ref{3.3} they give an efficient way to compute $w$ from $v^*$ and a bunch of homogeneous solutions. And finally, our goal, in Section \ref{3.4} they show how to compute $d\langle J \rangle_\infty /ds$.

\subsection{Describing perturbations by tangents}\label{3.1}

Now we use tangent solutions to describe trajectory perturbations coming from perturbations on the initial data and parameters. The perturbation due to parameter changes is described by inhomogeneous tangents\footnote{I don't know why}, and the one due to intial data changes is described by homogeneous tangents.

First we, differentiate Eq. \ref{eq:1} with respect to $s$, keeping $\phi$ constant. And rename $v^* = \partial u/ \partial s$. Thus, the equation for $v^*$ can be obtained from:
\begin{eqnarray}
  \frac{d}{ds} \left( \frac{du}{dt} \right)  = \frac{\partial }{\partial s} \left( \frac{\partial u}{\partial t} \right)= \frac{d}{ds}f(u,s),\nonumber\\
  \frac{\partial }{\partial t} \left( \frac{\partial u}{\partial s} \right) = \frac{\partial f}{\partial u} \frac{\partial u}{\partial s} + \frac{\partial f}{\partial s}\cancelto{1}{\frac{\partial u}{\partial u}},\nonumber\\
  \frac{\partial v^*}{\partial t}  = \partial_u fv^* + \partial_s f,
  \label{des:1}
\end{eqnarray}
For this to be true we need $u\in C^2$ at least. The initial conditions are easier to differentiate, since $\phi$ is fixed
\begin{eqnarray}
  \frac{d}{ds} u(t=0) = \cancelto{0}{\frac{d u_0(\phi)}{ds}},\nonumber\\
  v^*(t=0) = 0.\label{des:2}
\end{eqnarray}
Therefore, using Eqs. \ref{des:1} and \ref{des:2}, the dynamical equation for $v^*$ is
\begin{equation}
  \frac{dv^*}{dt} + \partial_u fv^* = \partial_s f, \quad v^*(t=0) = 0
  \label{eq:4}
,\end{equation}
where $\partial_u f$ is an $\mathbb{R}^m\times\mathbb{R}^m$ matrix\footnote{Think about why is m.} and $\partial_sf$ is an $\mathbb{R}^m$ vector. We must notice two things here: First, the second equation reflects that $u_0$ remains unchanged (the initial conditions). Second, by definition $v^*$ reflects the trajectory perturbation due to changes on the parameters, keeping the initial data constant, this was shown in the first column of Fig. \ref{fig:lz63}.

Under the assumption of ergodicity, the initial conditions don't affect the long-time behaviour. This suggests that $\phi$ is not necesarily fixed if we are only interested in the change of a long-time average. So, we define inhomogeneous tangent solutions as solutions to Eq. \ref{eq:4} without the initial condition,
\begin{equation}
  \frac{dv}{dt} + \partial_u fv = \partial_s f.
  \label{eq:5}
\end{equation}

Now, we got rid of the initial condition, so the system is underdetermined. In order to have a well-posed problem again we can add initial conditions or add one more equation. The second will be our approach. By definition $v$ reflects the perturbation of the trajectory due to a change in the parameter. That was half of what we were looking for, the other half is the part that describes perturbations on the trajectory due to changes in the initial data.

We define $w = \partial u / \partial \phi$, where $s$ is fixed and $w$ satisfies the so called homogenenous tangent equation:
\begin{equation}
  \frac{dw}{dt} + \partial_u fw = 0.
  \label{eq:6}
\end{equation}
By it's definition, $w$ describes the divergence in trajectories due to changes on the initial conditions while $s$ is fixed. As shown on the right column of Fig \ref{fig:lz63}.

Hence $v^*$ and $w$ describe the effects of only varying $s$ and $\phi$ respectively. for two different inhomogeneous solutions $v^*$ and $v$ the difference between them is a homogeneous tangent solution\footnote{We can go from $v^*$ to $v$ by adding the right $w$ to $v^*$, this will work, since $w$ is solution to the homogeneous equation and is equivalent to add one zero on the left hand side.}.

We know that by changing $s$ we generate two effects: one is equivalent to change $u_0$, and the other shifts the attractor. We are interested on the second one, so we need to find $w$ such that $v = v^* + w$ contains only the long-time effect.

Naturally we can not only add but also subtract $w$ from $v^*$. Such subtraction is the main idea behind NILSS. As previously stated, we want to find two trajectories associated with parameters $s$ and $s + \Delta s$ that do not diverge from each other. We can say that $v$ is sufficient to reveal the long time effect of varying one parameter, if the euclidean norm of its orthonormal projection onto $V^\perp (u)$ remains bounded as the trajectory length goes to infinity. We denote this sufficient v by the shadowing direction $v^\infty$, whose existence is proved by the shadowing Lemma\footnote{Read about this.}. Here $V^\perp(u)$ is defined as:
\begin{equation}
  V^\perp(u) = \{ p\in \mathbb{R}^m  : p^T f(u) = 0 \}.
  \label{eq:7}
\end{equation}
Moreover the orthogonal projection $p^\perp$ of $p$ is defined as:
\begin{equation}
  p^\perp = p - \frac{f^T p}{f^Tf}f.
  \label{eq:8}
\end{equation}
$v^{\infty\perp}$ is defined by substituting $p$ by $v^\infty$. We define $w^\perp$, $\delta u ^\perp$, $v^{*\perp}$, and ${\zeta_j^\perp}$ in a similar way. We use the norm of $v^{\infty\perp}$ because it describes the perpendicular distance between two trajectories.
\subsection{Constructing $w$ from unstable Characteristic Lyapunov Vectors (CLV)}\label{3.2}

\subsection{Computing $v^\perp$ by NILSS}\label{3.3}

\subsection{Computing $d\langle J \rangle_\infty /ds$ from the tangent solution}\label{3.4}

\section{Questions}
\begin{description}
  \item [1] What is a tangent solution?
  \item [2] What is a least squares problem?
  \item [3] What is an unstable mode?
  \item [4] What are the Lorenz 63 and the CFD simulation of flow over backward-facing step systems?
  \item [5] Why is NILSS good for systems with may degrees of freedom and few unstable modes?
\end{description}
\newpage
\section{To do}

\begin{enumerate}
  \item Find what tangent solutions are.
  \item Explain how the final solution is used to compute sensitivities.
\end{enumerate}



\bibliography{MyNotes.bib}
\bibliographystyle{ieeetr}
%
% Example citation \cite{Figueredo:2009dg}.
%
% %------------------------------------------------
%
% \subsection{Subsection 1} % Sub-section
%
% \lipsum[1] % Dummy text
%
% %------------------------------------------------
%
% \subsection{Subsection 2} % Sub-section
%
% \lipsum[2] % Dummy text
%
% %------------------------------------------------
%
% \subsubsection{Subsubsection 1} % Sub-sub-section
%
% \lipsum[3] % Dummy text
%
% \begin{figure}[H] % Example image
% \center{\includegraphics[width=0.5\linewidth]{placeholder}}
% \caption{Example image.}
% \label{fig:speciation}
% \end{figure}
%
% %------------------------------------------------
%
% \subsubsection{Subsubsection 2} % Sub-sub-section
%
% \lipsum[4] % Dummy text
%
% %----------------------------------------------------------------------------------------
% %	MAJOR SECTION 1
% %----------------------------------------------------------------------------------------
%
% \section{Content Section} % Major section
%
% \lipsum[5] % Dummy text
%
% %------------------------------------------------
%
% \subsection{Subsection 1} % Sub-section
%
% \subsubsection{Subsubsection 1} % Sub-sub-section
%
% \lipsum[6] % Dummy text
%
% %------------------------------------------------
% \newpage
% \subsubsection{Subsubsection 2} % Sub-sub-section
%
% \lipsum[6] % Dummy text
% \begin{wrapfigure}{l}{0.4\textwidth} % Inline image example
%   \begin{center}
%     \includegraphics[width=0.38\textwidth]{fish}
%   \end{center}
%   \caption{Fish}
% \end{wrapfigure}
% \lipsum[7-8] % Dummy text
%
% %------------------------------------------------
%
% \subsubsection{Subsubsection 3} % Sub-sub-section
%
% \begin{description} % Numbered list example
%
% \item[First] \hfill \\
% \lipsum[9] % Dummy text
%
% \item[Second] \hfill \\
% \lipsum[10] % Dummy text
%
% \item[Third] \hfill \\
% \lipsum[11] % Dummy text
%
% \end{description}
%
% %----------------------------------------------------------------------------------------
% %	MAJOR SECTION X - TEMPLATE - UNCOMMENT AND FILL IN
% %----------------------------------------------------------------------------------------
%
% %\section{Content Section}
%
% %\subsection{Subsection 1} % Sub-section
%
% % Content
%
% %------------------------------------------------
%
% %\subsection{Subsection 2} % Sub-section
%
% % Content
%
% %----------------------------------------------------------------------------------------
% %	CONCLUSION
% %----------------------------------------------------------------------------------------
%
% \section{Conclusion} % Major section
%
% \lipsum[12-13]

%----------------------------------------------------------------------------------------
%	BIBLIOGRAPHY
%----------------------------------------------------------------------------------------

%\begin{thebibliography}{99} % Bibliography - this is intentionally simple in this template
%
% \bibitem[Figueredo and Wolf, 2009]{Figueredo:2009dg}
% Figueredo, A.~J. and Wolf, P. S.~A. (2009).
% \newblock Assortative pairing and life history strategy - a cross-cultural
%   study.
% \newblock {\em Human Nature}, 20:317--330.
%
% \end{thebibliography}

%----------------------------------------------------------------------------------------

\end{document}
